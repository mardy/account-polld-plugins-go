#!/usr/bin/make -f
# -*- makefile -*-

export DH_OPTIONS
export DH_GOPKG := launchpad.net/account-polld
export DH_GOLANG_INSTALL_ALL := 1

%:
	dh $@ \
		--buildsystem=golang \
		--with=golang \
		--with=translations \
		--fail-missing

override_dh_auto_install:
	dh_auto_install -O--buildsystem=golang
	# all our libs are private
	rm -r \
		${CURDIR}/debian/account-polld-plugins-go/usr/share/gocode
	# translations
	appname=account-polld; \
	for pofile in po/*.po; do \
		pofilename="$${pofile##*/}"; \
		langcode="$${pofilename%.*}"; \
		localedir="debian/account-polld-plugins-go/usr/share/locale/$$langcode/LC_MESSAGES"; \
		mkdir -p $$localedir; \
		mofile="$$localedir/$$appname.mo"; \
		msgfmt -o $$mofile $$pofile; \
	done
	# manifest files
	manifestdir="debian/account-polld-plugins-go/usr/share/account-polld/plugins"; \
	mkdir -p "$$manifestdir"; \
	cp data/polld-*.json "$$manifestdir"

override_dh_strip:
	echo "Skipping strip (LP: #1318027)"
